## Motion Detection Library

### Module information

- Motion Detection Library to run background subtraction algorithms
on the input frames
- The system is input source independent:
    - Can be from either:
        - Zero MQ source
        - Recorded Video
- Currently the library can be tested by running the bin/testRunner binary
- Shared library generated by CMake in lib/motion_detection.so
- The Frame Difference algorithm produces the most promising results hence is the preferred setup


### Prerequisites:
- OpenCV 3.3.1 is a Prerequisite
    - If built with CUDA enabled need to make fixes to the PMOG2 gpu algorithm as explained in the comments
    - Else Frame difference or PMOG2 cpu algorithm must be used

### Development setup:
- After cloning the repository using git clone
- We need to update the submodules this can be done using:
```bash
  git submodule update --init --recursive
```
- Once this is done we can follow on with the rest of the procedure


## Build system
### General information
- CMake is used in the project : It builds libraries, binaries, unit tests and documentation.
- At the moment, it cannot do cross platform builds as it is.
- At the moment, `install` configurations are not created (so `make install` doesn't do anything). Feel free to improve it.

### How to build
#### Binaries only
```bash
  foo@bar:~$ cd build
  foo@bar:~$ cmake ..
  foo@bar:~$ make -j$(nproc)
```
- By default, a `Release` version will be built. If you want to build a `Debug` version use add `-DCMAKE_BUILD_TYPE=Debug` to the cmake command.
- Built binaries will end up in `bin`.
#### Documentation
```bash
  foo@bar:~$ cd build
  foo@bar:~$ cmake -DGEN_DOCS=ON ..
  foo@bar:~$ make -j$(nproc) MotionDetectionDocs
```
- Output doxygen documentation will be in `doc/html` and `doc/latex`.

## Testing our application(After packaging):
- Run the following commands from test directory:

```bash
  foo@bar:~$ ./runtest.sh
```

## Profiling results:
- Profiling was undertaken using videos 67-74 from the test bench from nexus
- The videos encompass 2408 frames captured at a resolution of 1936x1096
- A NMS suppression threshold of 0.5 was used for generating collated bounding boxes
- Background subtraction was run on half resolution(resizeFactor = 0.5) images
- Dilation and Erosion Kernel sizes were: (2,2){config parameters}
- Algorithms were fixed to ignore bounding boxes with an area less than 0.0005 of the original image

| Algorithm Name  | Frame Rate | Dilation & Erosion |
| ----------------|:----------:| :-----------------:|
| Frame Difference| 69.72fps   | Yes                |
| MOG2CPU         | 60.91fps   | NO                 |

- Key: fps = Frames Per Second = (2408/time taken for background removal process to finish)

- Note: Same conditions have been used for generating the test bench: The text files in exp/testBenchForTestFunctions
- Commit Number for current test bench: 89f353d1bea

     
## Directory structure
```
project
│   README.md
│   CMakeLists.txt
│
├───bin ( Executables )
│
├───build ( Build files )
│
├───doc ( Documentation or configuration files )
│
├───ext ( External components folder )
│
├───src ( Application source code )
|
├───inc ( Application Header files )
|
├───lib ( Shared libraries )
|
├───cfg ( Application config files )
│
└───test ( Test code files )
```
